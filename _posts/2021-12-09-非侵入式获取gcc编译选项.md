---
published: true
layout: post
title: 非侵入式获取gcc编译选项
category: gcc
catalog: true
tags:
  - gcc
time: '2021.12.29 01:33:00'
---
## 本文背景
由于需要对部门内以C语言服务进行编译参数排查，确保C语言构建项目配置了安全编译选项，如：`-fPIC`等。需要尝试寻找一种非侵入式代码方式即可获得各服务执行gcc编译所配置的参数。

## 技术方案探索
### -frecord-gcc-switches
此参数是gcc自带的编译参数。具体的介绍可以看[gcc文档描述](https://gcc.gnu.org/onlinedocs/gcc/Code-Gen-Options.html)。具体介绍如下：
```text
This switch causes the command line used to invoke the compiler to be recorded into the object file that is being
created.  
This switch is only implemented on some targets and the exact format of the recording is target and binary file format dependent, but it usually takes the form of a section containing ASCII text.  
This switch is related to the -fverbose-asm switch, but that switch only records information in the assembler output file as comments, so it never reaches the object file.  
See also -grecord-gcc-switches for another way of storing compiler options into the object file.
```

```shell
# 我本地有一个测试代码test_macros.c带-frecord-gcc-switches选项上进行编译，可以在此目录下获得一个a.out编译产物
gcc -frecord-gcc-switches -Wall test_macros.c
# 解析此编译文件
readelf -p .GCC.command.line a.out

# 可以获取到如下参数即为我们编译输入的相关参数
String dump of section '.GCC.command.line':
  [     0]  test_macros.c
  [     e]  -mtune=generic
  [    1d]  -march=x86-64
  [    2b]  -Wall
  [    31]  -frecord-gcc-switches

```
### -wrap
### 命令行中转

## 参考文献
