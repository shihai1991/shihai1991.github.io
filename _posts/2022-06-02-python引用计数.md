---
published: true
pblished: true
layout: post
title: python局部变量的一个疑问分析
category: container
catalog: true
tags:
  - container
time: '2022.06.02 09:49'
---

# 一、问题背景

遇到了一段代码，如下所示，第一眼的直觉是变量`ins`是一个局部变量，重复调用`test()`函数会反复创建新的实例`ins`。
```
import sys


def test():
    ins = object()
    print(id(ins))


while True:
    test()
```

但实际情况却是在进程运行期间不会创建新的局部变量`ins`。
```shell
140076922921824
140076922921824
140076922921824
140076922921824
```

# 二、原因分析
## 2.1 引用计数分析
在上面示例代码中补充一行代码看一下实际的`ins`引用变量计数情况，代码如下所示：
```python
mport sys


def test():
    ins = object()
    print(id(a))
    ref = sys.getrefcount(ins)
    print(f'引用计数: {ref}')


while True:
    test()

```
执行此示例后的输出结果是：
```shell
139765934961536
引用计数: 2
139765934961536
引用计数: 2
139765934961536
引用计数: 2
```

## 2.2 字节码分析


# 参考附录
[Puzzled with LOAD_FAST/STORE_FAST of python](https://stackoverflow.com/questions/28088157/puzzled-with-load-fast-store-fast-of-python)
