---
layout: post
title: 分表性能优化
category: spring
catalog: true
published: false
tags:
  - spring
  - java
time: '2023.09.12 20:48:00'
---
# shardingSphere
流式查询：返回一个迭代器从而降低内存占用。

# 遇到的问题
数据库有多个分表，每个分表有2w+条记录，直接用Mybatis和Shardingsphere查询所有表中数据，服务就长期不会返回数据,导致这个现象的原因我估计是数据层通过流式计算和归并排序算法操作防止占用大量内存却导致时间开销增加了。  
另外，对同一数据源的多条相同执行SQL会进行`UNION ALL`进行归并操作来降低对数据库连接资源的消耗。

# 结论
在mysql中，`limit x, y`或者`limit y offset x`实际上是等价操作，都是要获取前面x条记录，所以效率不是很高。

# 参考文章
- [ShardingSphere Pagination](https://shardingsphere.apache.org/document/5.0.0-alpha/cn/features/sharding/use-norms/pagination/#performance-bottleneck)
- [Apache ShardingSphere 5.1.0 执行引擎性能优化揭秘](https://www.modb.pro/db/337129)
- [LIMIT和OFFSET分页性能差！今天来介绍如何高性能分页](https://www.51cto.com/article/718182.html)
- [ShardingSphere example](https://github.com/apache/shardingsphere-example)